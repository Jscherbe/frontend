////
/// @group data-list
/// A responsive data list for self-explanatory list-like content. Uses CSS Grid 
/// and Subgrid to align columns on desktop, while gracefully stacking them 
/// on smaller screens. Not intended for complex tabular data requiring 
/// explicit column headers for context on mobile.
////

@use "sass:map";
@use "sass:math";

@use "../selector";
@use "../utils";
@use "../color";
@use "../breakpoint";

/// Module Settings
/// @type Map
/// @prop {String} grid-template-columns [1fr] The default master grid columns.
/// @prop {String} grid-template-columns-mobile [100%] The mobile grid columns (default is single column stack).
/// @prop {Dimension} row-gap [1px] The space between list items (rows).
/// @prop {Dimension} column-gap [1rem] The space between columns.
/// @prop {Color} background-color [transparent] The default background color for items.
/// @prop {Color} background-color-even [null] The background color for even-numbered items (for striping).
/// @prop {Color} background-color-hover [null] The background color for items on hover.
/// @prop {String} mobile-breakpoint ["small"] The breakpoint below which groups stack.
/// @prop {Number} span-count [4] The number of span modifiers to create, increase if needed, (ie. data-list__column--span-2, --span-3, ...)

$config: (
  "grid-template-columns": 1fr,
  "grid-template-columns-mobile": 100%,
  "row-gap": 1px,
  "column-gap": 1rem,
  "background-color": transparent,
  "background-color-even": #f9f9f9,
  "background-color-hover": #f0f0f0,
  "background-color-clickable-hover": #e8e8e8, // Slightly darker for interactive indication
  "mobile-breakpoint": "small",
  "span-count" : 6,
) !default;

/// Change modules $config
/// @param {Map} $changes Map of changes
@mixin set($changes) {
  $config: map.merge($config, $changes) !global;
}

/// Get a config option
/// @param {Map} $name Name of property
@function get($name) {
  @return utils.require-map-get($config, $name, "data-list [config]");
}

/// Prints component styles
/// @demo data-list
@mixin styles {
  @include utils.file-header('component', 'data-list');

  $prefix: selector.class("data-list");
  $mobile-bp: get("mobile-breakpoint");
  
  // 1. Container (Defines the master grid)
  #{ $prefix } {
    display: grid;
    gap: get("row-gap");
    // Allows inline override via custom property, falls back to config default
    grid-template-columns: var(--ulu-data-list-columns, get("grid-template-columns"));
    list-style: none;
    margin: 0;
    padding: 0;

    @include breakpoint.max($mobile-bp) {
      // Switch to mobile grid template (defaults to 100% stack, but can be overridden for persistent cols)
      grid-template-columns: var(--ulu-data-list-columns-mobile, get("grid-template-columns-mobile"));
    }
  }

  // 2. Row Item (Passes the grid down)
  #{ $prefix }__item {
    display: grid;
    grid-template-columns: subgrid;
    grid-column: 1 / -1;
    gap: get("column-gap");
    padding: 1rem;
    background-color: color.get(get("background-color"));

    @include breakpoint.max($mobile-bp) {
      // We keep display: grid/subgrid here to respect the mobile parent grid
      gap: 0.5rem; 
    }

    @if (get("background-color-hover")) {
      &:hover {
        background-color: color.get(get("background-color-hover"));
      }
    }
  }

  // 3. Columns (The cells / wrappers)
  #{ $prefix }__column {
    display: flex;
    align-items: center;
    gap: get("column-gap");
    // Defensive Layout: Prevents flexbox/grid from refusing to shrink below intrinsic content size.
    // Without this, a long unbroken word or URL could force the column to expand, blowing out the grid.
    // It allows text-overflow: ellipsis to work safely within a column without breaking the layout.
    min-width: 0; 
  }

  // 4. Automatic Groups (Subgrid on desktop, stack on mobile)
  #{ $prefix }__column:has(> #{ $prefix }__column) {
    display: grid;
    grid-template-columns: subgrid;
    // Default span is 1, use modifiers below for larger spans
    
    @include breakpoint.max($mobile-bp) {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: stretch;
      gap: 0.25rem; // Tighter vertical gap when stacked
    }
  }

  // 5. Header Row (Optional)
  #{ $prefix }__header {
    display: contents; // Removes wrapper so children participate in grid

    // Hide headers on mobile since columns stack
    @include breakpoint.max($mobile-bp) {
      display: none;
    }

    #{ $prefix }__item {
      font-weight: bold;
      background-color: transparent;
      border-bottom: 2px solid color.get("rule"); // Stronger separator
      
      &:hover {
        background-color: transparent; // No hover effect on headers
      }
    }
  }

  // --- Modifiers ---

  // Structural Edge Modifiers (Decorating the default 1fr track)
  #{ $prefix }--prefixed {
    grid-template-columns: var(--ulu-data-list-columns, auto 1fr);
    @include breakpoint.max($mobile-bp) {
      grid-template-columns: var(--ulu-data-list-columns-mobile, auto 1fr);
    }
  }
  #{ $prefix }--suffixed {
    grid-template-columns: var(--ulu-data-list-columns, 1fr auto);
    @include breakpoint.max($mobile-bp) {
      grid-template-columns: var(--ulu-data-list-columns-mobile, 1fr auto);
    }
  }
  #{ $prefix }--prefixed#{ $prefix }--suffixed {
    grid-template-columns: var(--ulu-data-list-columns, auto 1fr auto);
    @include breakpoint.max($mobile-bp) {
      grid-template-columns: var(--ulu-data-list-columns-mobile, auto 1fr auto);
    }
  }

  // Striped Rows
  #{ $prefix }--striped {
    @if (get("background-color-even")) {
      #{ $prefix }__item:nth-child(even) {
        background-color: color.get(get("background-color-even"));
      }
    }
  }

  // Interactive Rows (Proxy Click Support)
  // Applied to parent to indicate all rows are interactable
  #{ $prefix }--clickable {
    #{ $prefix }__item {
      cursor: pointer;
      &:hover {
        background-color: color.get(get("background-color-clickable-hover"));
      }
    }
  }

  // Spanning (Required when a subgrid contains multiple child columns)
  @for $i from 2 through get("span-count") {
    #{ $prefix }__column--span-#{$i} {
      grid-column: span #{$i};
      
      // Reset span on mobile so it fits the simplified grid
      @include breakpoint.max($mobile-bp) {
        grid-column: auto;
      }
    }
  }

  // Desktop padding adjustment
  @include breakpoint.min("medium") {
    #{ $prefix }__item {
      padding: 1rem 2rem;
    }
  }
}