
////
/// @group flipcard
////
/// Creates adaptive (changing at breakpoints)n between items (vertical/horizontal layout)

@use "sass:map";
@use "sass:math";
@use "../element";
@use "../utils";

/// Module Settings
/// @type Map

/// @todo 
/// setup three options: default, center-title, bottom-title
/// default: title in middle, icon on bottom right
/// center-title: title in middle. Icon in middle
/// bottom-title: icon on bottom-left, title directly above


$config: (
  "background-color" : white,
  "border" : 1px solid black,
  "border-radius" : 6px,
  "border-color-hover" : black,
  "control-button-border-focus" : 2px solid blue,
  "anim-duration" : 430ms,
  "anim-delay" : 200ms,
  "padding" : 1.5rem,
  "title-color" : red,
  "title-color-hover" : green,
  "icon-color" : pink,
  "icon-color-hover" : aqua,
  "icon-color-image" : aqua,
  "icon-color-image-hover" : pink,
  "title-color-image" : black,
  "title-color-image-hover" : blue,
  "bottom-shadow" : true
);

/// Change modules $config
/// @param {Map} $changes Map of changes
///   @include module-name.set(( "property" : value ));

@mixin set($changes) {
  $config: map.merge($config, $changes) !global;
}

/// Set sizes map
/// @param {Map} $changes Map of changes
/// @param {String} $merge-mode Merge mode see utils.map-merge() [null|"deep"|"overwrite"]

@mixin set-sizes($changes, $merge-mode: null) {
  $sizes: utils.map-merge($sizes, $changes, $merge-mode) !global;
}

/// Get a config option
/// @param {Map} $name Name of property
///   @include module-name.get("property");

@function get($name) {
  @return utils.require-map-get($config, $name, "flipcard [config]");
}

/// Prints adaptive spacing component styles
/// @example scss
///  @include ulu.component-adaptive-spacing-styles();

@mixin styles {
  // @dan @joe-check added vignette styling here. Need to discuss best way to include this
  .flipcard {
    height: 100%;
    // border: element.get-rule-style("light");
    background-color: get("background-color");
    line-height: 1.4;
    overflow: hidden;
    position: relative;
    border: get("border");
    border-radius: get("border-radius");
    &.Flipcard:hover {
      border-color: get("border-color-hover");
    }
    .Flipcard__control-button:focus {
      border: get("control-button-border-focus");
    }
  }
  .flipcard__front,
  .flipcard__back {
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }
  
  .flipcard__front {
    // To lay the image out on top of the text
    display: grid;
    grid-template-columns: 1fr;
    justify-items: stretch;
    grid-template-areas: "flipcard-front";
    &:hover {
      .flipcard__front-image {
        transition-duration: 8000ms;
        transition-delay: 0;
        transform: scale(1.15);
      }
      .flipcard__front-content {
        color: get("title-color-hover");
      }
      .flipcard__icon {
        color: get("icon-color-hover");
      }
    }
    [data-flipcard-state="open"] & {
      opacity: 0;
      animation: flipcard-front-close get('anim-duration') ease-out forwards;
    }
    [data-flipcard-state="closed"] & {
      animation: flipcard-front-open get('anim-duration') ease-in-out forwards;
    }
  }
  .flipcard--w-image {
    &:hover {
      .flipcard__front-content {
        color: get("title-color-image-hover");
      }
      .flipcard__icon {
        color: get("icon-color-image-hover");
      }
    }
  }
  .flipcard__front-image,
  .flipcard__front-content {
    grid-area: flipcard-front / flipcard-front / flipcard-front / flipcard-front;
  }
  .flipcard__front-image {
    display: block;
    @media (prefers-reduced-motion) {
      transition: transform 1000ms 200ms ease-out;
    }
    img {
      object-fit: cover;
      width: 100%;
      height: 100%;
      opacity: 0.7;
    }
  }
  .flipcard__icon {
    color: get('icon-color');
    display: block;
    margin-top: 0.5rem;
  }
  .flipcard__front-content {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    color: get("title-color");
    position: relative;
    z-index: 2;
    padding: get('padding');
    align-self: end;
    transition: transform 350ms ease-in-out;
    // So that it doesn't ride up when the user hovers
    
  }
  .flipcard--w-image {
    .flipcard__icon {
      color: get("icon-color-image");
    }
    .flipcard__front-content {
      color: get("title-color-image");
      @if(get("bottom-shadow")) {
        &:after {
          content: '';
          display: block;
          position: absolute;
          top: calc(0rem - get('padding'));
          bottom: calc(0rem - get('padding'));
          left: calc(0rem - get('padding'));
          right: calc(0rem - get('padding'));
          background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.5));
          z-index: -1;
        }
      }
    }
  }
  .flipcard__back {
    // background-color: red;
    padding: get('padding');
    justify-content: flex-end;
    [data-flipcard-state="open"] & {
      animation: flipcard-back-open get('anim-duration') ease-out forwards;
      @media (prefers-reduced-motion) {
        animation: fadeIn 430ms ease-in-out;
      }
    }
  }
  @keyframes flipcard-back-open {
    0% {
      opacity: 0;
      // transform: scale(0.7);
      // transform: translatey(100%);
    }
    30% {
      opacity: 0;
      transform: translatey(100%);
    }
    100% {
      opacity: 1;
      // transform: scale(1);
      transform: translatey(0);
    }
  }
  @keyframes flipcard-front-close {
    0% {
      opacity: 1;
      // transform: scale(1);
    }
    80% {
      opacity: 0;
      // transform: scale(0.7);
    }
    100% {
      opacity: 0;
    }
  }
  @keyframes flipcard-front-open {
    0% {
      opacity: 0;
      // transform: scale(0.7);
    }
    // 30% {
    //   opacity: 0;
    // }
    100% {
      opacity: 1;
      // transform: scale(1);
    }
  }
}

.flipcard--center-title {
  .flipcard__front-content {
    justify-content: center;
    align-items: center;
  }
}
.flipcard--bottom-title {
  .flipcard__front-content {
    justify-content: flex-end;
  }
}
// .flipcard:not(.flipcard--bottom-title, .flipcard--center-title) {
//   .flipcard__front-content {
//     align-items: center;
//     justify-content: center;
//   }
//   .flipcard__icon-container {
//     margin-top: 0;
//     width: 100%;
//     display: flex;
//     align-items: flex-end;
//     justify-content: flex-end;
//   }
// }
.flipcard:not(.flipcard--bottom-title, .flipcard--center-title) {
  .flipcard__front-content {
    align-items: center;
  }
  .flipcard__icon-container {
    margin-top: 0;
    height: calc(50% - get("padding") / 2);
    // height: calc(50% - get("padding"));
    width: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: flex-end;
  }
}
// modifier for animations
.flipcard--animation:hover {
  .flipcard__front-content {
    transform: translatey(-(get('padding') * 0.5));
  }
}